<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        html {
            height: 100%;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100%;
            background: linear-gradient(135deg, #428bca, #32fff8);
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        .top-container {
            width: 80%;
            height: auto;
            margin: 0 auto 20px;
            padding: 0px;
            background: linear-gradient(135deg, #428bca, #50e3c34c); /* Match with body gradient */
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.16);
            z-index: 2;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .header {
            width: 70%;
            padding: 0px;
            background:#302d2d16; 
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.2);
            z-index: 2;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .header h1 {
            color: #fff;
            text-align: center;
            margin: 15px 0;
            font-size: 32px;
        }

        .button-row {
            display: flex;
            padding: 10px;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin-bottom: 0px;
        }

        .menu {
            position: relative;
            width: 40%; 
            margin: 0 auto; 
            background-color: #428bca00; 
            top: -10px;
            padding: 10px; 
            box-sizing: border-box; 
            z-index: 1;
        }

        .team-container {
            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
            align-items: center;
            height: 550px;
            background: linear-gradient(to bottom, 
                #36b017 0%, #36b017 10%, 
                #36b715 10%, #36b715 20%, 
                #36b017 20%, #36b017 30%, 
                #36b715 30%, #36b715 40%, 
                #36b017 40%, #36b017 50%, 
                #36b715 50%, #36b715 60%, 
                #36b017 60%, #36b017 70%, 
                #36b715 70%, #36b715 80%, 
                #36b017 80%, #36b017 90%, 
                #36b715 90%, #36b715 100%);
            position: relative; 
            padding-top: 20px;
            width: 40%;
            margin: 0 auto;
            border: 2px solid #fff;
            z-index: 0;
        }

        .penalty-box1 {
            position: absolute;
            top: 85%; 
            left: 28%; 
            width: 44%;
            height: 15%;
            border-right: 2px solid #fff;
            border-top: 2px solid #fff;
            border-left: 2px solid #fff;
            z-index: -1;
        }

        .penalty-box2 {
            position: absolute;
            top: 0%;
            left: 28%;
            width: 44%; 
            height: 15%;
            border-right: 2px solid #fff;
            border-bottom: 2px solid #fff;
            border-left: 2px solid #fff;
            z-index: -1;
        }

        .halfway-line {
            position: absolute;
            top: 50%; /* Adjust the top position of the halfway line as needed */
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #fff; /* Set color for the halfway line */
            z-index: -1;
        }

        .halfway-line2 {
            position: absolute;
            top: 41%; /* Adjust the top position of the penalty box as needed */
            left: 40%; /* Adjust the left position of the penalty box as needed */
            width: 20%; /* Adjust the width of the penalty box as needed */
            height: 18%; /* Adjust the height of the penalty box as needed */
            border: 2px solid #fff; /* Add white dashed border */
            border-radius: 50%; /* Create a circle */
            z-index: -1;
            box-sizing: border-box; /* Ensure the border is included in the dimensions */
            background-color: transparent; /* Make the background transparent */
        }

        .player-row {
            display: flex;
            justify-content: space-evenly;
            width: 100%;
        }

        .player-position {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            width: 15%; /* Adjust the width as needed */
            margin: 5px; /* Add some margin for spacing */
            padding: 10px; /* Add some padding for spacing */
            background-color: rgba(205, 195, 195, 0.3); /* Adjust the background color */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Add a box shadow effect */
            margin-top: 20px; /* Adjust the margin-top as needed */
            border-radius: 10%;
        }

        .player-position .name {
            margin-top: 10px; /* Add some spacing between name and price */
            font-weight: bold;
        }


        .change-button {
            width: 35px; /* Adjust the icon size */
            height: 35px; /* Adjust the icon size */
            border-radius: 50%;
            background-color: rgb(15, 200, 206);
            margin-top: 5px; /* Add margin for spacing */
            position: relative;
            border: 0px solid black; 
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); 
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .change-button:hover {
            background-color: #00d5d1;
            transform: scale(1.05); /* Slightly enlarges button on hover for feedback */
        }

        .change-button i {
            /* Adjust the size and color of the icon as needed */
            font-size: 20px;
            color: #fff;
        }

        .player-position {
            position: relative;
        }

        .player-position .name {
            font-size: 12px; /* Adjust the font size */
            margin-top: 8px; /* Add some spacing between name and price */
            font-weight: bold;
        }

        .player-position .price {
            margin-bottom: 2px; /* Adjust the spacing */
            font-size: 12px; /* Adjust the font size */
        }

        
        .save-button {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 5px 10px;
            background-color: #1c9800;
            color: #fff;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center; 
            cursor: pointer;
        }

        .save-button:hover {
            background-color: #0dcc3d;
            transform: scale(1.05); /* Slightly enlarge button on hover */
        }

        .return-button {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background-color: #dd0e0e;
            color: #fff;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease; 
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center; /* Centers the content */
            cursor: pointer;
        }

        .return-button:hover {
            background-color: #cc0d0d;
            transform: scale(1.05); /* Slightly enlarge button on hover */
        }

        .refresh-button {
            position: absolute;
            top: 10px;
            right: 50px;
            padding: 5px 10px;
            background-color: #a3a3a3;
            color: #fff;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease; 
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center; /* Centers the content */
            cursor: pointer;
        }

        .button-base {
            position: relative;
            padding: 5px 10px;
            margin: 0 10px;
            background:#4acfff0f; 
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.16);
            color: #fff;
            border: 2px solid #333; /* Slightly grayish border for a bit of depth */
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease; /* Added a quick transform transition */
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center; /* Centers the content */
        }


        .free-transfers {
            position: relative;
            padding: 10px 20px; 
            border: none;
            background:#302d2d00; 
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.271);
        }

        .free-transfers.active {
            position: relative;
            padding: 10px 20px; 
            color: #535353;
            border: none;
            background: linear-gradient(135deg, #5cfffa7b, #23f91fad);
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.271);
        }

        .cost {
            position: relative;
            padding: 10px 20px;  
            border: none;
            background:#302d2d00; 
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.271);
        }

        .total-price {
            position: relative;
            padding: 10px 20px; 
            border: none;
            background:#302d2d00; 
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.271);
        }
        
        .disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .budgetValue {
            color: black; 
        }

        .total-price.less-than-zero {
            color: rgba(255, 0, 0, 0.903); 
        }

        .text-red {
            color: rgba(255, 0, 0, 0.903);
        }

    </style>
    
    <script>
        function openPlayerList(playerIndex) {
            var playerList = document.getElementById("playerList" + playerIndex);
            playerList.classList.toggle("show");
        }

        function goBack() {
            var teamName = "{{ team_name }}";
            window.location.href = "/team_management/{{ team_name }}";
        }

        function changePlayer(playerIndex) {
            var teamName = "{{ team_name }}";  // Preserve the team_name from the template
            window.location.href = "/change_player_transfer?playerIndex=" + playerIndex + "&teamName=" + teamName;
        }



        document.addEventListener("DOMContentLoaded", function() {
            var totalPrice = parseFloat("{{ totalPrice }}"); // Assuming you have the totalPrice value in your template
            calculateTotalPrice();
        });

        function calculateTotalPrice() {
            var prices = document.getElementsByClassName("price");
            var total = 0;
            var budget = 40;
            
            var chip_used = "{{ chip_used }}";
            console.log(chip_used);



            if (chip_used !== 'Limitless') {

                for (var i = 0; i < prices.length; i++) {
                    var priceText = prices[i].textContent;
                    var price = parseFloat(priceText.replace("£", "").replace("m", ""));
                    if (!isNaN(price)) {
                        total += price;
                    }
                }
                budget -= total;

                var budgetValueElement = document.getElementById('budgetValue');
                var totalPriceElement = document.getElementById("totalPrice");

                if (budget < 0) {
                    saveButton.classList.add("disabled");
                    document.getElementById("saveButton").disabled = true;
                    budgetValueElement.classList.add('less-than-zero');
                    if (totalPriceElement) {
                        totalPriceElement.style.color = "red"; // Set the text color of totalPriceElement to red
                    }
                } else {
                    saveButton.classList.remove("disabled");
                    document.getElementById("saveButton").disabled = false;
                    budgetValueElement.classList.remove('less-than-zero');
                    if (totalPriceElement) {
                        totalPriceElement.style.color = ""; // Remove any explicit text color style
                    }
                }

                if (totalPriceElement) {
                    totalPriceElement.textContent = "Bank: £" + budget.toFixed(1) + "m";
                }
            }
        }

        // When the document is loaded, perform the check
        document.addEventListener("DOMContentLoaded", function() {
            // Assuming transfer_data.values()|last produces a number, retrieve that number
            var transferCost = parseFloat(document.getElementById("transferCost").textContent.split(":")[1].trim());

            // If the value is less than 0, add the 'text-red' class to change the color
            if (transferCost < 0) {
                document.getElementById("transferCost").classList.add("text-red");
            }
        });




    </script>
</head>
<body>

    <div class="top-container">
        <div class="header">
            <h1>Make Transfers</h1>
        </div>
        <div class="button-row">
            <div class="button-base free-transfers {{ 'active' if chip_used == 'Wildcard' or chip_used == 'Limitless' else '' }}">
                Free Transfers:
                {% set transfer_data_keys = transfer_data.keys() %}
                {% if transfer_data_keys|last == 'Gameweek 1 Cost' or chip_used == 'Wildcard' or chip_used == 'Limitless' %}
                    <i class="fas fa-infinity"></i>
                {% else %}
                    {{ free_transfer }}
                {% endif %}
            </div>
        
            {% if chip_used != 'Limitless' %}
                <div class="button-base cost" id="cost">
                    <span id="transferCost">Cost: {{ transfer_data.values()|last }}</span>
                </div>
            {% endif %}
            
            <div class="button-base free-transfers {{ 'active' if chip_used == 'Limitless' else '' }}" id="totalPrice">
                {% if chip_used == 'Limitless' %}
                    Bank: <i class="fas fa-infinity"></i>
                {% else %}
                    <span id="budgetValue"></span>
                {% endif %}
            </div>
        </div>
        
    </div>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <div class="menu">
        <form id="saveForm" action="/save_transfers/{{ team_name }}">
            <button id="saveButton" class="save-button">Save</button>
        </form>
        <form id="saveForm" action="/load_transfers/{{ team_name }}">
            <button class="refresh-button" onclick="goBack()">
                <i class="fa fa-refresh"></i>
            </button>  
        </form>   
        <button class="return-button" onclick="goBack()">
            <i class="fa fa-trash-o"></i>
        </button>        
    </div>
    <div class="team-container">
        <div class="penalty-box1"></div>
        <div class="penalty-box2"></div>
        <div class="halfway-line"></div>
        <div class="halfway-line2"></div>
        <div class="player-row">
            {% for player in injury_data %}
                {% if player['Player'] == team_data['Player 1'] %}
                    {% if player['injury_colour'] == 'Red' %}
                        <div class="player-position" style="background-color: #ff00007f;">
                            <button type="button" class="change-button" onclick="changePlayer(1)">
                                <i class="fas fa-exchange-alt" style="color: #ff0000;"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% elif player['injury_colour'] == 'Yellow' %}
                        <div class="player-position" style="background-color: #fffb007f;">
                            <button type="button" class="change-button" onclick="changePlayer(1)">
                                <i class="fas fa-exchange-alt" style="color: #fffb00;"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% else %}
                        <div class="player-position">
                            <button type="button" class="change-button" onclick="changePlayer(1)">
                                <i class="fas fa-exchange-alt"></i>
                            </button>
                            <div class="name">{{ team_data['Player 1'] }}</div>
                            <div class="price">{{ player_databases[team_data['Player 1']] }}</div>
                        </div>
                    {% endif %}
                {% endif %}
            {% endfor %}
        </div>
        <div class="player-row">
            {% for player in injury_data %}
                {% if player['Player'] == team_data['Player 2'] %}
                    {% if player['injury_colour'] == 'Red' %}
                        <div class="player-position" style="background-color: #ff00007f;">
                            <button type="button" class="change-button" onclick="changePlayer(2)">
                                <i class="fas fa-exchange-alt" style="color: #ff0000;"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% elif player['injury_colour'] == 'Yellow' %}
                        <div class="player-position" style="background-color: #fffb007f;">
                            <button type="button" class="change-button" onclick="changePlayer(2)">
                                <i class="fas fa-exchange-alt" style="color: #fffb00;"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% else %}
                        <div class="player-position">
                            <button type="button" class="change-button" onclick="changePlayer(2)">
                                <i class="fas fa-exchange-alt"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% endif %}
                {% endif %}
            {% endfor %}
            {% for player in injury_data %}
                {% if player['Player'] == team_data['Player 3'] %}
                    {% if player['injury_colour'] == 'Red' %}
                        <div class="player-position" style="background-color: #ff00007f;">
                            <button type="button" class="change-button" onclick="changePlayer(3)">
                                <i class="fas fa-exchange-alt" style="color: #ff0000;"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% elif player['injury_colour'] == 'Yellow' %}
                        <div class="player-position" style="background-color: #fffb007f;">
                            <button type="button" class="change-button" onclick="changePlayer(3)">
                                <i class="fas fa-exchange-alt" style="color: #fffb00;"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% else %}
                        <div class="player-position">
                            <button type="button" class="change-button" onclick="changePlayer(3)">
                                <i class="fas fa-exchange-alt"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% endif %}
                {% endif %}
            {% endfor %}
        </div>
        <div class="player-row">
            {% for player in injury_data %}
                {% if player['Player'] == team_data['Player 4'] %}
                    {% if player['injury_colour'] == 'Red' %}
                        <div class="player-position" style="background-color: #ff00007f;">
                            <button type="button" class="change-button" onclick="changePlayer(4)">
                                <i class="fas fa-exchange-alt" style="color: #ff0000;"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% elif player['injury_colour'] == 'Yellow' %}
                        <div class="player-position" style="background-color: #fffb007f;">
                            <button type="button" class="change-button" onclick="changePlayer(4)">
                                <i class="fas fa-exchange-alt" style="color: #fffb00;"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% else %}
                        <div class="player-position">
                            <button type="button" class="change-button" onclick="changePlayer(4)">
                                <i class="fas fa-exchange-alt"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% endif %}
                {% endif %}
            {% endfor %}
            {% for player in injury_data %}
                {% if player['Player'] == team_data['Player 5'] %}
                    {% if player['injury_colour'] == 'Red' %}
                        <div class="player-position" style="background-color: #ff00007f;">
                            <button type="button" class="change-button" onclick="changePlayer(5)">
                                <i class="fas fa-exchange-alt" style="color: #ff0000;"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% elif player['injury_colour'] == 'Yellow' %}
                        <div class="player-position" style="background-color: #fffb007f;">
                            <button type="button" class="change-button" onclick="changePlayer(5)">
                                <i class="fas fa-exchange-alt" style="color: #fffb00;"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% else %}
                        <div class="player-position">
                            <button type="button" class="change-button" onclick="changePlayer(5)">
                                <i class="fas fa-exchange-alt"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% endif %}
                {% endif %}
            {% endfor %}
        </div>
        <div class="player-row">
            {% for player in injury_data %}
                {% if player['Player'] == team_data['Player 6'] %}
                    {% if player['injury_colour'] == 'Red' %}
                        <div class="player-position" style="background-color: #ff00007f;">
                            <button type="button" class="change-button" onclick="changePlayer(6)">
                                <i class="fas fa-exchange-alt" style="color: #ff0000;"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% elif player['injury_colour'] == 'Yellow' %}
                        <div class="player-position" style="background-color: #fffb007f;">
                            <button type="button" class="change-button" onclick="changePlayer(6)">
                                <i class="fas fa-exchange-alt" style="color: #fffb00;"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% else %}
                        <div class="player-position">
                            <button type="button" class="change-button" onclick="changePlayer(6)">
                                <i class="fas fa-exchange-alt"></i>
                            </button>
                            <div class="name">{{ player['Player'] }}</div>
                            <div class="price">{{ player_databases[player['Player']] }}</div>
                        </div>
                    {% endif %}
                {% endif %}
            {% endfor %}
        </div>
    </div>
</body>
</html>